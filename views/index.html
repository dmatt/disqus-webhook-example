<!DOCTYPE html>
<html>
  <head>
    <title>Wistia Webhooks Demo</title>
    <meta name="description" content="How to use Wistia webhooks to build an app that hears about events in Wistia as they happen">
    <link id="favicon" rel="icon" href="https://cdn.glitch.com/fa923940-f3fc-440e-a0c8-6ba5804bf6d0%2Ffavicon.ico?1490716873266" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    <!-- Welcome note -->
    <p>
      Hi! This here's a demo of <a href="https://wistia.com/doc/webhooks">Wistia Webhooks</a>.
    </p>
    <p>
      Play the video below to see webhooks in action. Then, click the "Remix on Glitch" button to see the source and make it your own.
    </p>
    
    <!-- Standard (aka async) embed -->
    <script src="https://fast.wistia.com/embed/medias/t7clqlza0a.jsonp" async></script>
    <script src="https://fast.wistia.com/assets/external/E-v1.js" async></script>
    <div class="wistia_embed wistia_async_t7clqlza0a" style="height:360px;width:640px">&nbsp;</div>
    
    <div id="webhooks_log" class="log_wrapper">
      <pre v-highlightjs="payloads"><code class="javascript log"></code></pre>
    </div>
    
    
    <!-- Vue.js -->
    <script src="https://unpkg.com/vue"></script>
    
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"></script>

    <!-- highlight.js -->
    <link rel="stylesheet" href="highlighting.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
    
    <script>
      // as webhooks payloads come in from the server side via Socket.IO, we add them
      // to this `payloads` array. Vue.js takes care of updating the UI to show these
      // payloads in the console below the video.
      window.payloads = [];
      var socket = io();
      socket.on('event', function(payload){
        // Only display webhooks generated by the current viewer on this page
        // If we didn't do this check, all events for the account used in this demo
        // would get logged to the demo page for everybody looking at it at that time.
        if (payload.visitor.id == Wistia.visitorKey.value()) {
          // Prepend the latest payload to the array of payloads.
          // The "2" here makes the output get pretty-printed with 2 spaces for indentation.
          // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify#The_space_argument
          payloads.unshift(JSON.stringify(payload, null, 2))
        }
      });


      // Get syntax highlighting working with Vue.js
      // credit: https://www.metachris.com/2017/02/vuejs-syntax-highlighting-with-highlightjs/
      Vue.directive('highlightjs', {
        deep: true,
        bind: function (el, binding) {
          // on first bind, highlight all targets
          let targets = el.querySelectorAll('code')
          targets.forEach((target) => {
            // if a value is directly assigned to the directive, use this
            // instead of the element content.
            if (binding.value) {
              target.textContent = binding.value
            }
            hljs.highlightBlock(target)
          })
        },
        componentUpdated: function (el, binding) {
          // after an update, re-fill the content and then highlight
          let targets = el.querySelectorAll('code')
          targets.forEach((target) => {
            if (binding.value) {
              target.textContent = binding.value
              hljs.highlightBlock(target)
            }
          })
        }
      })

      // This is where we tell Vue.js which data to display in the UI.
      // Vue takes care of updating the UI as that data changes. Thanks, Vue!
      var app = new Vue({
        el: '#webhooks_log',
        data: {
          payloads: payloads
        }
      })
    </script>
    
    <!-- The Glitch button -->
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js"></script>
    <!-- A little script to add a "More [Team Name] Projects" button to that ðŸ‘† -->
    <script src="https://team-projects-button.glitch.me/js/team-projects-button.js"></script>
    
  </body>
</html>
