<!DOCTYPE html>
<html>
  <head>
    <title>Wistia Webhooks Demo</title>
    <meta name="description" content="How to use Wistia webhooks to build an app that hears about events in Wistia as they happen">
    <link id="favicon" rel="icon" href="https://cdn.glitch.com/fa923940-f3fc-440e-a0c8-6ba5804bf6d0%2Ffavicon.ico?1490716873266" type="image/x-icon">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/style.css">
  </head>
  <body>
    
    <!-- Welcome note -->
    <p>
      Hi! This here's a demo of <a href="https://wistia.com/doc/webhooks">Wistia Webhooks</a>.
    </p>
    <p>
      Play the video below to see webhooks in action. Then, click the "Remix on Glitch" button to see the source and make it your own.
    </p>
    
    <!-- Standard (aka async) embed -->
    <script src="https://fast.wistia.com/embed/medias/t7clqlza0a.jsonp" async></script>
    <script src="https://fast.wistia.com/assets/external/E-v1.js" async></script>
    <div class="wistia_embed wistia_async_t7clqlza0a" style="height:360px;width:640px">&nbsp;</div>
    
    <div id="webhooks_log">
      <pre>
        <code class="log">
        </code>
      </pre>
    </div>
    
    
    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.7.3/socket.io.js"></script>

    <!-- highlight.js -->
    <link rel="stylesheet" href="highlighting.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.10.0/highlight.min.js"></script>
    
    
    <script>
      var webhooksLog = document.getElementById("webhooks_log");
      
      // make the empty code block a little pretty to start
      var codeBlock = document.getElementsByTagName("code")[0]
      hljs.highlightBlock(codeBlock);
      
      
      // as webhooks payloads come in from the server side via Socket.IO, we add them
      // to this `payloads` array, then stringify that data and show it on the page.
      window.payloads = [];
      var socket = io();
      socket.on('event', function(payload){
        // Only display webhooks generated by the current viewer on this page
        // If we didn't do this check, all events for the account used in this demo
        // would get logged to the demo page for everybody looking at it at that time.
        if (payload.visitor.id == Wistia.visitorKey.value()) {
          // Prepend the latest payload to the array of payloads.
          payloads.unshift(payload);
          showPayloads(payloads);
        }
      });
      
      function showPayloads(payloads) {
        webhooksLog.innerHTML = `<h3>Here are the payloads</h3>`;
        var code = document.createElement("code");
        code.className = "log"
        var pre = document.createElement("pre");
        pre.innerHTML = JSON.stringify(payloads, null, 2);
        code.appendChild(pre)
        webhooksLog.appendChild(code);
        hljs.highlightBlock(code);
      }
    </script>
    
    <!-- The Glitch button -->
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js"></script>
    <!-- A little script to add a "More [Team Name] Projects" button to that ðŸ‘† -->
    <script src="https://team-projects-button.glitch.me/js/team-projects-button.js"></script>
    
  </body>
</html>
